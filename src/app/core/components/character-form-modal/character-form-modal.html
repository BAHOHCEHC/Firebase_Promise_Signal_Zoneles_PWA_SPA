<div class="modal-backdrop" (click)="close.emit()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h3 class="modal-title">
      {{ isEditMode() ? 'Edit character' : 'Add new character' }}
    </h3>

    <!-- Елементи -->
    <div class="section section-elements">
      <p class="section-label fs_14">Select element</p>
      <div class="elements-row">
        @for (el of elementTypes; track el) {
        <button type="button" class="element-btn" [class.active]="selectedElement() === el" (click)="selectElement(el)">
          <img [src]="'/assets/images/ElementType_' + el + '.png'" [alt]="el" />
        </button>
        }
      </div>
    </div>

    <div class="middle-block">
      <div class="middle-block_left">
        <!-- Прев’ю + фон рідкості -->
        <div class="preview-section" [style.background-image]="'url(' + selectedRarity().bgUrl + ')'">
          <div class="preview-section-element-image">
            <img [src]="'/assets/images/ElementType_' + selectedElement() + '.png'" [alt]="selectedElement()" />
          </div>
          <div class="preview-avatar-wrapper">
            @if (previewImage()) {
            <img class="preview-avatar" [src]="previewImage()" [alt]="form.value.name || 'Character preview'" />
            }
          </div>

          <!-- Завантаження зображення -->
          <label class="upload-btn">
            <input type="file" accept="image/*" (change)="onImagePick($event)" hidden />
          </label>
        </div>
      </div>

      <div class="middle-block_right">
        <!-- Рідкість -->
        <div class="section">
          <select class="rarity-select" (change)="selectRarity($any($event.target).value)">
            <option value="legendary">Legendary (5★)</option>
            <option value="epic">Epic (4★)</option>
          </select>
        </div>

        <!-- Ім'я -->
        <div class="section">
          <label class="section-label fs_14" for="name">Name</label>
          <input type="text" class="name-input" id="name" placeholder="Enter character name"
            [formControl]="form.controls.name"
            [class.error]="form.controls.name.invalid && form.controls.name.touched" />

          <!-- Помилки валідації -->
          @if (form.controls.name.touched && form.controls.name.invalid) {
          <div class="form-error">
            @if (form.controls.name.errors?.['required']) {
            Name is required
            } @else if (form.controls.name.errors?.['minlength']) {
            Name must be at least 3 characters
            }
          </div>
          }
        </div>
      </div>
    </div>

    <!-- Кнопки дій -->
    <div class="actions">
      <!-- КНОПКА ВИДАЛЕННЯ — ТІЛЬКИ ПРИ РЕДАГУВАННІ -->
      @if (isEditMode()) {
        <button type="button" class="btn-delete" (click)="delete()">
          Delete
        </button>
      }

      <button type="button" class="btn-cancel" (click)="close.emit()">
        Cancel
      </button>
      <button type="button" class="btn-save" [disabled]="form.invalid" (click)="save()">
        {{ isEditMode() ? 'Update' : 'Save' }}
      </button>
    </div>


  </div>
</div>
