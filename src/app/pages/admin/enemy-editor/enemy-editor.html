<section class="editor">
  <!-- HEADER -->
  <header class="editor__header">
    <div class="editor__actions">
      <!-- Add Enemies -->
      <button
        class="btn fs_24"
        [class.btn-secondary-disabled]="!canAddEnemy()"
        [class.btn-primary-default]="canAddEnemy()"
        [disabled]="!canAddEnemy()"
        (click)="openEnemiesUniversalModal('enemy')"
      >
        Add Enemies
        <span class="material-symbols-outlined">add</span>
      </button>

      <!-- Add Group -->
      <button
        class="btn fs_24"
        [class.btn-secondary-disabled]="!canAddGroup()"
        [class.btn-primary-default]="canAddGroup()"
        [disabled]="!canAddGroup()"
        (click)="openEnemiesUniversalModal('group')"
      >
        Add Group
        <span class="material-symbols-outlined">amp_stories</span>
      </button>

      <!-- Add Categories -->
      <button class="btn fs_24 btn-primary-white" (click)="openEnemiesUniversalModal('categories')">
        Add categories
        <span class="material-symbols-outlined">app_registration</span>
      </button>
    </div>
  </header>

  <!-- Categories Tabs -->
  @if (hasCategories()) {
    <div class="categories-tabs">
      @for (cat of categories(); track cat.id) {
        <div class="btn-wrap">
          <button
            class="tab-btn"
            [class.active]="activeCategoryId() === cat.id"
            (click)="selectCategory(cat.id)"
          >
            {{ cat.title }}
          </button>
          <button class="tab-btn-edit-category" (click)="onEditCategory(cat.id)">
            <svg
              class="color-green"
              width="16"
              height="16"
              viewBox="0 0 14 14"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <mask
                id="mask0_211_38713"
                style="mask-type: alpha"
                maskUnits="userSpaceOnUse"
                x="0"
                y="0"
                width="14"
                height="14"
              >
                <rect width="14" height="14" fill="#D9D9D9" />
              </mask>
              <g mask="url(#mask0_211_38713)">
                <path
                  d="M1.1665 13.9998V11.6665H12.8332V13.9998H1.1665ZM3.49984 9.33317H4.3165L8.8665 4.79775L8.03525 3.9665L3.49984 8.5165V9.33317ZM2.33317 10.4998V8.02067L8.8665 1.50192C8.97345 1.39498 9.09741 1.31234 9.23838 1.254C9.37935 1.19567 9.52762 1.1665 9.68317 1.1665C9.83873 1.1665 9.98942 1.19567 10.1353 1.254C10.2811 1.31234 10.4123 1.39984 10.529 1.5165L11.3311 2.33317C11.4478 2.44011 11.5328 2.5665 11.5863 2.71234C11.6398 2.85817 11.6665 3.00886 11.6665 3.16442C11.6665 3.31025 11.6398 3.45366 11.5863 3.59463C11.5328 3.7356 11.4478 3.86442 11.3311 3.98109L4.81234 10.4998H2.33317Z"
                  fill="#0CD27C"
                />
              </g>
            </svg>
          </button>
        </div>
      }
    </div>
  }

  <!-- Content Area (Active Category Groups) -->
  @if (activeCategory(); as category) {
    <div class="editor__content">
      <div class="groups-grid">
        <!-- Groups List -->
        @for (group of category.groups; track group.id) {
          <div class="group-item">
            <div class="group-header">
              <span class="group-title">{{ group.title }}</span>
              <button class="btn-icon edit-btn" (click)="onEditGroup(group, category.id)">
                <svg
                  class="color-green"
                  width="16"
                  height="16"
                  viewBox="0 0 14 14"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <mask
                    id="mask0_211_38713"
                    style="mask-type: alpha"
                    maskUnits="userSpaceOnUse"
                    x="0"
                    y="0"
                    width="14"
                    height="14"
                  >
                    <rect width="14" height="14" fill="#D9D9D9" />
                  </mask>
                  <g mask="url(#mask0_211_38713)">
                    <path
                      d="M1.1665 13.9998V11.6665H12.8332V13.9998H1.1665ZM3.49984 9.33317H4.3165L8.8665 4.79775L8.03525 3.9665L3.49984 8.5165V9.33317ZM2.33317 10.4998V8.02067L8.8665 1.50192C8.97345 1.39498 9.09741 1.31234 9.23838 1.254C9.37935 1.19567 9.52762 1.1665 9.68317 1.1665C9.83873 1.1665 9.98942 1.19567 10.1353 1.254C10.2811 1.31234 10.4123 1.39984 10.529 1.5165L11.3311 2.33317C11.4478 2.44011 11.5328 2.5665 11.5863 2.71234C11.6398 2.85817 11.6665 3.00886 11.6665 3.16442C11.6665 3.31025 11.6398 3.45366 11.5863 3.59463C11.5328 3.7356 11.4478 3.86442 11.3311 3.98109L4.81234 10.4998H2.33317Z"
                      fill="#0CD27C"
                    />
                  </g>
                </svg>
              </button>
            </div>

            <div class="enemies-list">
              @for (enemy of getEnemiesForGroup(group.id); track enemy.id) {
                <div class="enemy-item">
                  <div class="enemy-card">
                    <img
                      [src]="enemy.avatarUrl || 'assets/images/mock_avatar.png'"
                      class="enemy-avatar"
                      alt="enemy"
                      [title]="enemy.name"
                    />

                    <div class="delete-overlay" (click)="onDeleteEnemy(enemy.id)">
                      <span class="material-symbols-outlined">close</span>
                    </div>

                    <!-- Element Icon overlay -->
                    @if (enemy.element.name !== 'empty') {
                      <img
                        [src]="'assets/images/ElementType_' + enemy.element.name + '.png'"
                        class="enemy-element-icon"
                        [alt]="enemy.element.name + ' element'"
                      />
                    }
                  </div>
                </div>
              }
            </div>
          </div>
        } @empty {
          <div class="no-groups-message">
            <span class="material-symbols-outlined">group</span>
            <p>No groups in this category yet. Create your first group!</p>
          </div>
        }
      </div>
    </div>
  } @else {
    @if (hasCategories()) {
      <div class="no-category-selected">
        <span class="material-symbols-outlined">category</span>
        <p>Select a category to view its groups and enemies</p>
      </div>
    } @else {
      <div class="no-categories-message">
        <span class="material-symbols-outlined">inventory_2</span>
        <p>No categories found. Create your first category!</p>
      </div>
    }
  }

  <!-- Modals -->
  @if (isEditorModalOpen()) {
    <app-enemy-editor-modal
      [type]="editorModalType()"
      [data]="editorModalData()"
      [categories]="categories()"
      [activeCategoryId]="activeCategoryId()"
      (save)="onSaveEditor($event)"
      (delete)="onDeleteFromModal()"
      (close)="isEditorModalOpen.set(false)"
    >
    </app-enemy-editor-modal>
  }

  @if (isConfirmModalOpen()) {
    <app-confirm-modal
      [title]="
        deleteContext() === 'group'
          ? 'Delete Group'
          : deleteContext() === 'category'
            ? 'Delete Category'
            : 'Delete Enemy'
      "
      [message]="
        deleteContext() === 'group'
          ? 'Are you sure you want to delete this group? All enemies in this group will also be deleted.'
          : deleteContext() === 'category'
            ? 'Are you sure you want to delete this category? All groups and enemies in this category will also be deleted.'
            : 'Are you sure you want to delete this enemy?'
      "
      confirmButtonText="Delete"
      type="danger"
      (confirm)="confirmDelete()"
      (close)="isConfirmModalOpen.set(false)"
    >
    </app-confirm-modal>
  }
</section>
