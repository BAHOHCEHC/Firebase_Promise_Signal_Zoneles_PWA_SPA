<section class="editor">
  <!-- HEADER -->
  <header class="editor__header">
    <div class="editor__actions">
      <!-- Add Enemies -->
      <button class="btn fs_24" [class.btn-secondary-disabled]="!canAddEnemy()"
        [class.btn-primary-default]="canAddEnemy()" [disabled]="!canAddEnemy()"
        (click)="openEnemiesUniversalModal('enemy')">
        Add Enemies
        <span class="material-symbols-outlined">add</span>
      </button>

      <!-- Add Group -->
      <button class="btn fs_24" [class.btn-secondary-disabled]="!canAddGroup()"
        [class.btn-primary-default]="canAddGroup()" [disabled]="!canAddGroup()"
        (click)="openEnemiesUniversalModal('group')">
        Add Group
        <span class="material-symbols-outlined">amp_stories</span>
      </button>

      <!-- Add Categories -->
      <button class="btn fs_24 btn-primary-white" (click)="openEnemiesUniversalModal('categories')">
        Add categories
        <span class="material-symbols-outlined">app_registration</span>
      </button>
    </div>
  </header>

  <!-- Categories Tabs -->
  @if (hasCategories()) {
  <div class="categories-tabs">
    @for (cat of categories(); track cat.id) {
    <button class="tab-btn" [class.active]="activeCategoryId() === cat.id" (click)="selectCategory(cat.id)">
      {{ cat.title }}
    </button>
    }
  </div>
  }

  <!-- Content Area (Active Category Groups) -->
  @if (activeCategory(); as category) {
  <div class="editor__content">
    <div class="groups-grid">
      <!-- Groups List -->
      @for (group of category.groups; track group.id) {
      <div class="group-item">
        <div class="group-header">
          <span class="group-title">{{ group.title }}</span>
          <button class="btn-icon edit-btn" (click)="onEditGroup(group, category.id)">
            <svg class="color-green" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
          </button>
        </div>

        <div class="enemies-list">
          @for (enemy of getEnemiesForGroup(group.id); track enemy.id) {
          <div class="enemy-item">
            <div class="enemy-card">
              <img [src]="enemy.avatarUrl || 'assets/images/mock_avatar.png'" class="enemy-avatar" alt="enemy"
                [title]="enemy.name">

              <div class="delete-overlay" (click)="onDeleteEnemy(enemy.id)">
                <span class="material-symbols-outlined">close</span>
              </div>

              <!-- Element Icon overlay -->
              @if (enemy.element.name !== 'empty') {
              <img [src]="'assets/images/ElementType_' + enemy.element.name + '.png'" class="enemy-element-icon"
                [alt]="enemy.element.name + ' element'">
              }@else{
              <svg class="enemy-element-icon" xmlns="http://www.w3.org/2000/svg" width="27" height="27" viewBox="0 0 27 27" fill="none">
                <path
                  d="M3 24V27C2.175 27 1.46875 26.7063 0.88125 26.1188C0.29375 25.5312 0 24.825 0 24H3ZM0 21V18H3V21H0ZM0 15V12H3V15H0ZM0 9V6H3V9H0ZM3 3H0C0 2.175 0.29375 1.46875 0.88125 0.88125C1.46875 0.29375 2.175 0 3 0V3ZM6 27V24H9V27H6ZM6 3V0H9V3H6ZM12 27V24H15V27H12ZM12 3V0H15V3H12ZM18 27V24H21V27H18ZM18 3V0H21V3H18ZM24 24H27C27 24.825 26.7063 25.5312 26.1188 26.1188C25.5312 26.7063 24.825 27 24 27V24ZM24 21V18H27V21H24ZM24 15V12H27V15H24ZM24 9V6H27V9H24ZM24 3V0C24.825 0 25.5312 0.29375 26.1188 0.88125C26.7063 1.46875 27 2.175 27 3H24Z"
                  fill="white" />
              </svg>
              }
            </div>
          </div>
          }
        </div>
      </div>
      } @empty {
      <div class="no-groups-message">
        <span class="material-symbols-outlined">group</span>
        <p>No groups in this category yet. Create your first group!</p>
      </div>
      }
    </div>
  </div>
  } @else {
  @if (hasCategories()) {
  <div class="no-category-selected">
    <span class="material-symbols-outlined">category</span>
    <p>Select a category to view its groups and enemies</p>
  </div>
  } @else {
  <div class="no-categories-message">
    <span class="material-symbols-outlined">inventory_2</span>
    <p>No categories found. Create your first category!</p>
  </div>
  }
  }

  <!-- Modals -->
  @if (isEditorModalOpen()) {
  <app-enemy-editor-modal [type]="editorModalType()" [data]="editorModalData()" [categories]="categories()"
    [activeCategoryId]="activeCategoryId()" (save)="onSaveEditor($event)" (close)="isEditorModalOpen.set(false)">
  </app-enemy-editor-modal>
  }

  @if (isConfirmModalOpen()) {
  <app-confirm-modal title="Delete Enemy" message="Are you sure you want to delete this enemy?"
    confirmButtonText="Delete" type="danger" (confirm)="confirmDelete()" (close)="isConfirmModalOpen.set(false)">
  </app-confirm-modal>
  }
</section>
